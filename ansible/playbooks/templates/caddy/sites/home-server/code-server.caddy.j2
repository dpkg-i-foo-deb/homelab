{{ lan_prefix }}.{{ code_personal_host }}.{{ internet_host }},
{{ code_personal_host }}.{{ internet_host }} {

  @waf {
    import waf_skip_images
    import waf_skip_archives
    import waf_skip_websockets
  }

  coraza_waf @waf {
    load_owasp_crs

    directives "
      Include /etc/caddy/waf/core/owasp_coraza.conf
      Include /etc/caddy/waf/rules/code-server.conf
      Include /etc/caddy/waf/core/crs_rules.conf
    "
  }

  import logging personal_code.log
  import error_handler
  import letsencrypt_cloudflare_dns
  import proxy_oauth {{ hostvars['code_server']['ansible_host']}}:4181 http://{{ hostvars['code_server']['ansible_host'] }}:8443
}

{{ lan_prefix }}.{{ code_work_host }}.{{ internet_host }},
{{ code_work_host }}.{{ internet_host }} {

  @waf {
    import waf_skip_images
    import waf_skip_archives
    import waf_skip_websockets
  }

  coraza_waf @waf {
    load_owasp_crs

    directives "
      Include /etc/caddy/waf/core/owasp_coraza.conf
      Include /etc/caddy/waf/rules/code-server.conf
      Include /etc/caddy/waf/core/crs_rules.conf
    "
  }


  import logging work_code.log
  import error_handler
  import letsencrypt_cloudflare_dns
  import proxy_oauth {{ hostvars['code_server']['ansible_host']}}:4180 http://{{ hostvars['code_server']['ansible_host'] }}:8444
}
