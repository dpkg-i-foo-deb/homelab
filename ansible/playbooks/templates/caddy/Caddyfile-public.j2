# DO NOT MODIFY MANUALLY, GENERATED WITH ANSIBLE
# Global config
{

  admin 0.0.0.0:2019

  metrics

  servers {
    trusted_proxies static private_ranges
  }

}

# Snippets

# Proxy with compression. Uses plain HTTP
(proxy) {
  encode {
    zstd better
    gzip 6
  }
  reverse_proxy {args[0]}
}


# Proxy with compression. Uses https and ignores tls stuff
(proxy_tls) {
  encode {
    zstd better
    gzip 6
  }
  reverse_proxy {args[0]} {
    transport http {
      tls
      tls_insecure_skip_verify
    }
  }
}

# Fetch certificates using Cloudflare DNS

(letsencrypt_cloudflare_dns) {
  tls {
    dns cloudflare {env.CF_API_TOKEN}
    propagation_timeout -1
    propagation_delay 120s
  }
}

# VPN Service

{{ vpn_host }}.{{ internet_host }} {
  import proxy 10.0.254.3:8080
}


# Authentication portal

{{ auth_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ auth_host }}.{{ internet_host }}
}

{{ remote_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ remote_host }}.{{ internet_host }}
}

{{ code_personal_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ code_personal_host }}.{{ internet_host }}
}

{{ code_work_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ code_work_host }}.{{ internet_host }}
}

# Music service

{{ music_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ music_host }}.{{ internet_host }}
}

# Note taking service

{{ notes_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ notes_host }}.{{ internet_host }}
}

{{ password_mgr_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ password_mgr_host }}.{{ internet_host }}
}

# RSS service

{{ rss_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ rss_host }}.{{ internet_host }}
}

# Photos service

{{ photos_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ photos_host }}.{{ internet_host }}
}

# Metrics service

{{ metrics_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ metrics_host }}.{{ internet_host }}
}

# Registry service

{{ registry_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ registry_host }}.{{ internet_host }}
}

# Home Assistant

{{ home_assistant_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ home_assistant_host }}.{{ internet_host }}
}

# AWX

{{ automation_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ automation_host }}.{{ internet_host }}
}

# Termix

{{ remote_ssh_host }}.{{ internet_host }} {
  import letsencrypt_cloudflare_dns
  import proxy https://{{ lan_prefix }}.{{ remote_ssh_host}}.{{ internet_host }}
}